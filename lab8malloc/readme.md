首先我先介绍一下lab这个如何测试，有两种方式：

1. 将代码放到malloclab/grade/handin里面，命名都随你便

   然后进入到这个相对目录下：sudo ./grade-handins.pl （因为他是在/tmp去执行的，所以需要root权限，也意味着不可以调试）

   之后就会在malloclab/grade/handin.grades生产相应文件名字的得分

2. 进入到malloclab/src，在mm.c中写就行，之后make即可

   然后可以 

   ```bash
   make &&  ./mdriver  -t ../traces/  -v 
   ```

   就能看到相应的得分，这个方法就可以用gdb调试，我一般写的时候是ln一个硬链接比较方便。

   ```bash
   make && gdb --args ./mdriver  -t ../traces/  -v
   ```

   



下面正式开始介绍这个lab：

我们要明白这个malloc lab 的设计，**实际上是设计一个高效地管理一个字节数组中内容的数据结构**（这个数组在实际的进程中其实就是进程的堆空间）。

只要明白我们是在设计一个数据结构，那么问题就回到了数据结构的分析过程：

### 我们首先会拿到一个空闲数组（通过malloc），接下来我们就得对此数组进行分配

1. 如何存储（表示）空闲块和分配块？该使用那种基础数据结构呢？
2. 如何分配块？
3. 如何释放块？
4. 如何合并相邻的空闲块？又该在什么时候合并？

**下面为了叙述方便，这个字节数组都用堆来表示**。

#### 1. 结构

1. 隐式链表： 用一位来表示是否分配即可，分配块需要O(n)，释放为O(1)
2. 显式链表： 用链表来将所有的空闲块串起来，分配块需要 O(空闲块数量) ，释放为O(1)
3. 分离链表：用一个个装等价类的链表来存储空闲块， 分配块平均可以达到O(long 空闲块数量) ，释放为O(1)
4. rb-tree： 我在网上（我忘了在哪找到的了）找到的一个用红黑树做的97分的高分做法
5. 分离链表 + trick：[李秋豪](https://www.cnblogs.com/liqiuhao/p/8252373.html)实现的一个通过针对测试用例的trick 和分离链表，可以得到98分。



如果你想参照<font color='orange'>中规中矩</font>的写法你可以看看我的代码：malloclab/grade/handin，我写的显式、分离，分别可以拿到90分，和88分，代码相对来说<font color='orange'>比较好理解注释也比较清楚。</font>

如果你想看看<font color='cornflowerblue'>如何做trick让分数更高</font>可以看看李秋豪的博客（上面ctrl+左键名字即可）

如果<font color='orange'>你想挑战自己</font>，并且全部都用指针实现，你可以尝试去看看malloclab/grade/handin.back， 说实话他写的真的太厉害了，全部都是自己写的，并且还实现了红黑树的高分版本。



另外我还实现了作业题9.17和9.18的代码，也是比较清楚的。





